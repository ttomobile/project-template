# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このリポジトリは新規プロジェクトのテンプレートです。プロジェクト開始時にスマートに整った環境で作業を開始できるようにすることが目的で、すべてのファイルやディレクトリ構造は必要に応じてオーバーライドされることを想定しています。

## 開発コマンド

このプロジェクトは `Makefile` で共通エントリを提供します。各ターゲットは `npm run` や `poetry run` など既存ツールの薄いラッパーとして実装してください：

- `make setup` - 依存関係と環境ファイルを整備
- `make lint` - 静的解析やフォーマッタを実行
- `make test` - 自動テストを一括実行
- `make run` - ローカルアプリやサンドボックスを起動
- `make audit` - セキュリティスキャナを実行（リリース前に必須）

## アーキテクチャとディレクトリ構成

このテンプレートは最小構成です。実装時は以下の構造に従ってください：

### ソースコード (`src/`)
領域別に分類して可読性を保つ：
- `src/api` - API エンドポイント・インターフェース層
- `src/core` - ビジネスロジック・ドメイン層
- `src/ui` - UI コンポーネント・プレゼンテーション層

### テスト (`tests/`)
ソース構造を鏡写しにする：
- `tests/unit` - 単体テスト（分岐網羅 80% 以上を目標）
- `tests/integration` - 結合テスト
- `tests/fixtures` - 共有フィクスチャ

### その他
- `scripts/` - 自動化スクリプト
- `config/` - リリースに含める設定
  - ローカル専用設定（例：`config/local.yml`）は `.gitignore` で除外
- `docs/` - ドキュメント

## コーディングスタイル

### フォーマットとエンコード
- 使用言語に合わせたフォーマッタ（ESLint/Prettier、Ruff/Black、gofmt など）を導入し CI で強制
- マークアップやスクリプトは 2 スペース、Python 系は 4 スペース
- UTF-8・LF を共通のエンコードとする
- `.editorconfig` をルートに配置してエディタ差異を抑える

### 命名規約
- 公開クラスや型：`PascalCase`
- 関数や変数：`camelCase`
- ファイル・ディレクトリ：`kebab-case`

## コミットとブランチ戦略

### コミットメッセージ
Conventional Commits を使用：
- `feat:` - 新機能
- `fix:` - バグ修正
- `chore:` - その他の変更

### ブランチ命名
- `feature/<チケット>` - 新機能
- `bugfix/<チケット>` - バグ修正
- ブランチは短命に保つ

### マージ
- squash でマージして履歴を直線的に維持
- 最低 1 名のレビューを受ける

## プルリクエスト

`.github/pull_request_template.md` に従って以下を含める：
- 簡潔な概要（2〜3行）
- 関連 Issue（`Closes #番号` 形式）
- 変更内容のチェックリスト（新機能・バグ修正・ドキュメント）
- 動作確認（`make lint`、`make test` の実行）
- UI や CLI 変更の証跡（スクリーンショット・ログ）
- セキュリティ影響の確認

## セキュリティと設定管理

- 機密情報はリポジトリに含めない
- ローカル用の秘密：`.env.local`（gitignore 対象）
- 共有用の雛形：`.env.example`（クリーニング済み）
- 環境変数ベースの設定を優先（12-factor 準拠）
- 依存パッケージ追加時は CVE を確認
- リリース前に `make audit` でセキュリティスキャン実行

## レビュー方針

このリポジトリは複数の AI コードレビューツール向けの指針を持っています。レビュー時は以下を優先：

1. **仕様逸脱・潜在的バグ・セキュリティリスク**を最優先で指摘
2. 根拠となる**ファイル名と該当行を明記**
3. テストが未更新の場合は追加テストを促す
4. 推測ではなくソースに基づく指摘のみ
5. すべてのコメントは**日本語**で記載

指摘時は「問題点」「理由」「推奨対応」の3点をセットで提示し、可能であればコード例を添える。
